@using Microsoft.AspNet.Identity
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title - Shop</title>
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")
    <link href='//fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:400,100,100italic,300,300italic,400italic,700,900,900italic,700italic' rel='stylesheet' type='text/css'>
    <link href="~/Content/skdslider.css" rel="stylesheet">
    <link href="~/Content/font-awesome.css" rel="stylesheet" />
</head>
<body>
    <!-- header -->
    <div class="agileits_header">
        <div class="container">
            @*<div class="w3l_offers">
                    <p>SALE UP TO 70% OFF. USE CODE "SALE70%" . <a href="products.html">SHOP NOW</a></p>
                </div>*@
            @*<div class="agile-login">
                    <ul>
                        @if (!User.Identity.IsAuthenticated)
                        {
                            <li><a href="@Url.Action("Register","Account")">Tạo Tài Khoản</a></li>
                            <li><a href="@Url.Action("Login","Account")">Đăng nhập</a></li>

                        }
                        else
                        {
                            <li><a href="#">Chào @User.Identity.GetUserName()</a></li>
                            <li><a onclick="document.getElementById('logOffForm').submit();" href="#">Thoát</a></li>
                        }
                        <li><a href="@Url.Action("Help","Home")">Giúp đỡ</a></li>
                    </ul>
                    @using (Html.BeginForm("LogOff","Account",FormMethod.Post,new {id="logOffForm"}))
                    {
                        @Html.AntiForgeryToken()
                    }
                </div>*@
            <div class="product_list_header">
                <form action="#" method="post" class="last">
                    <input type="hidden" name="cmd" value="_cart">
                    <input type="hidden" name="display" value="1">
                    <button class="w3view-cart" type="submit" name="submit" value=""><i class="fa fa-cart-arrow-down" aria-hidden="true"></i></button>
                </form>
            </div>
            <div class="clearfix"> </div>
        </div>
    </div>

    <div class="logo_products">
        <div class="container">
            <div class="w3ls_logo_products_left1">
                <ul class="phone_email">
                    <li><i class="fa fa-phone" aria-hidden="true"></i>Đt : 0989352216</li>

                </ul>
            </div>
            <div class="w3ls_logo_products_left">
                <h1><a href="index.html">super Market</a></h1>
            </div>
            <div class="w3l_search">
                <form action="#" method="post">
                    <input type="search" name="Search" placeholder="Search for a Product..." required="">
                    <button type="submit" class="btn btn-default search" aria-label="Left Align">
                        <i class="fa fa-search" aria-hidden="true"> </i>
                    </button>
                    <div class="clearfix"></div>
                </form>
            </div>

            <div class="clearfix"> </div>
        </div>
    </div>
    <!-- //header -->
    <!-- navigation -->
    <div class="navigation-agileits">
        <div class="container">
            <nav class="navbar navbar-default">
                <!-- Brand and toggle get grouped for better mobile display -->
                @Html.Action("Menu", "Home")
            </nav>
        </div>
    </div>
    <!-- //navigation -->
    <!-- //top-header and slider -->

    <div class="container-fluid">
        @RenderBody()
    </div>
    @Html.Partial("_Cart")
    <!-- //footer -->
    <div class="footer">
        <div class="container">
            <div class="w3_footer_grids">
                <div class="col-md-3 w3_footer_grid">
                    <h3>Liên hệ</h3>

                    <ul class="address">
                        <li><i class="glyphicon glyphicon-map-marker" aria-hidden="true"></i>1234k Avenue, 4th block, <span>New York City.</span></li>
                        <li><i class="glyphicon glyphicon-envelope" aria-hidden="true"></i><a href="mailto:info@example.com">info@example.com</a></li>
                        <li><i class="glyphicon glyphicon-earphone" aria-hidden="true"></i>0989352216</li>
                    </ul>
                </div>
                <div class="col-md-3 w3_footer_grid">
                    <h3>Thông tin</h3>
                    <ul class="info">
                        <li><i class="fa fa-arrow-right" aria-hidden="true"></i><a href="about.html">About Us</a></li>
                        <li><i class="fa fa-arrow-right" aria-hidden="true"></i><a href="contact.html">Contact Us</a></li>
                        <li><i class="fa fa-arrow-right" aria-hidden="true"></i><a href="short-codes.html">Short Codes</a></li>
                        <li><i class="fa fa-arrow-right" aria-hidden="true"></i><a href="faq.html">FAQ's</a></li>
                        <li><i class="fa fa-arrow-right" aria-hidden="true"></i><a href="products.html">Special Products</a></li>
                    </ul>
                </div>
                <div class="col-md-3 w3_footer_grid">
                    <h3>Danh mục</h3>
                    <ul class="info">
                        <li><i class="fa fa-arrow-right" aria-hidden="true"></i><a href="groceries.html">Groceries</a></li>
                        <li><i class="fa fa-arrow-right" aria-hidden="true"></i><a href="household.html">Household</a></li>
                        <li><i class="fa fa-arrow-right" aria-hidden="true"></i><a href="personalcare.html">Personal Care</a></li>
                        <li><i class="fa fa-arrow-right" aria-hidden="true"></i><a href="packagedfoods.html">Packaged Foods</a></li>
                        <li><i class="fa fa-arrow-right" aria-hidden="true"></i><a href="beverages.html">Beverages</a></li>
                    </ul>
                </div>
                <div class="col-md-3 w3_footer_grid">
                    <h3>Hồ sơ</h3>
                    <ul class="info">
                        <li><i class="fa fa-arrow-right" aria-hidden="true"></i><a href="products.html">Store</a></li>
                        <li><i class="fa fa-arrow-right" aria-hidden="true"></i><a href="checkout.html">My Cart</a></li>
                        <li><i class="fa fa-arrow-right" aria-hidden="true"></i><a href="login.html">Login</a></li>
                        <li><i class="fa fa-arrow-right" aria-hidden="true"></i><a href="registered.html">Create Account</a></li>
                    </ul>
                </div>
                <div class="clearfix"> </div>
            </div>
        </div>

        <div class="footer-copy">
            <div class="container">
                <p>
                    © @DateTime.Now.Year Super Market. All rights reserved | Design by <a href="mailto:bacuongtr@gmail.com">w3layouts</a>
                    Code by <a href="mailto:bacuongtr@gmail.com">bacuongtr@gmail.com</a>
                </p>
            </div>
        </div>

    </div>
    <div class="footer-botm">
        <div class="container">
            <div class="w3layouts-foot">
                <ul>
                    <li><a href="#" class="w3_agile_facebook"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
                    <li><a href="#" class="agile_twitter"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
                    <li><a href="#" class="w3_agile_dribble"><i class="fa fa-dribbble" aria-hidden="true"></i></a></li>
                    <li><a href="#" class="w3_agile_vimeo"><i class="fa fa-vimeo" aria-hidden="true"></i></a></li>
                </ul>
            </div>
            <div class="payment-w3ls">
                <img src="/Content/images/card.png" alt=" " class="img-responsive">
            </div>
            <div class="clearfix"> </div>
        </div>
    </div>
    <!-- //footer -->
    <!--Modal cart-->



    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")
    <script src="~/Scripts/skdslider.min.js"></script>
    <script src="~/Scripts/move-top.js"></script>
    <script src="~/Scripts/easing.js"></script>
    <script src="~/Scripts/store.everything.min.js"></script>

    @RenderSection("scripts", required: false)
    <script>
        jQuery(document).ready(function ($) {
            $(".scroll").click(function (event) {
                event.preventDefault();
                $('html,body').animate({ scrollTop: $(this.hash).offset().top }, 1000);
            });
            $().UItoTop({ easingType: 'easeOutQuart' });
            jQuery('#demo1').skdslider({ 'delay': 5000, 'animationSpeed': 2000, 'showNextPrev': true, 'showPlayButton': true, 'autoSlide': true, 'animationType': 'fading' });

            jQuery('#responsive').change(function () {
                $('#responsive_wrapper').width(jQuery(this).val());
            });
            $(".add-to-cart").click(function () {
                var data = $(this).data();

                if (!store.get(data.productId)) {
                    store.set(data.productId, { id: data.productId, price: data.price, priceDiscount: data.priceDiscount, title: data.productTitle, amount: 1, total: data.total });
                }

                $('#myModal').modal('show');
                $("#CartItems > tbody").empty();

                var countTotal = function () {
                    var total = 0;
                    store.each(function (value, key) {
                        total += value.price * value.amount;
                    });
                    return total;
                };

                $("#total").html(countTotal());

                store.each(function (value, key) {
                    $("#CartItems > tbody").append(`<tr><td>${value.id}</td><td>${value.title}</td><td><input class="amount" type="number" data-product-id="${value.id}" value="${value.amount}" min="1" name="amount"></td><td>${value.price}</td><td id="${value.id}">${value.price * value.amount}</td></tr>`);
                });


                $(".amount").change(function () {
                    var productId = $(this).data().productId;
                    var currentValue = $(this).val();
                    var price = store.get(productId).price;
                    $(`#${productId}`).html(price * currentValue);

                    store.update(productId, {}, function (productId) {
                        productId.amount = currentValue;
                    });
                    store.update(productId, {}, function (productId) {
                        productId.amount = currentValue;
                        productId.total = currentValue * productId.amount;
                    });
                    $("#total").html(countTotal());
                });

            });
            $("#check-out-btn").click(function () {
                var address = $("#address").val();
                var description = $("#description").val();
                var phone = $("#phone").val();
                var data = { address: address, description: description, phone: phone };
                var items = [];
                store.each(function (value, key) {
                    items.push({amount:value.amount,productId:key});
                });
                data.OrderItems = items;
                $.post("/checkout/index", { order: data }, function (result) {
                    if (result) {
                        $('#myModal').modal('hide');
                        alert("Bạn đã đặt hàng thành công");
                    }
                });
            });
        });
    </script>
</body>
</html>
